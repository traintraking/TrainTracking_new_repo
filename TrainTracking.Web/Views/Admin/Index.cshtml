@model List<TrainTracking.Domain.Entities.Booking>
@{
    ViewData["Title"] = "لوحة التحكم";
}

<div class="container py-4">
    <!-- Header Area -->
    <div class="d-flex justify-content-between align-items-center mb-5 admin-header p-4 rounded-4 shadow-sm bg-white-adaptive border-start border-primary border-5">
        <div>
            <h2 class="fw-bold mb-1 text-primary">لوحة تحكم KuwGo</h2>
            <p class="text-muted mb-0"><i class="fas fa-chart-line me-1"></i> متابعة أداء النظام والعمليات الحالية</p>
        </div>
        <div class="text-end">
            <div class="badge bg-soft-primary text-primary rounded-pill px-3 py-2 fw-bold">
                <i class="far fa-clock me-1"></i> تحديث تلقائي: @DateTime.Now.ToString("HH:mm")
            </div>
        </div>
    </div>

    <!-- KPI Cards Grid -->
    <div class="row g-4 mb-5">
        <div class="col-md-3">
            <div class="stat-card p-4 rounded-4 shadow-sm border-0 h-100 bg-gradient-primary text-white position-relative overflow-hidden">
                <div class="stat-icon-bg"><i class="fas fa-coins"></i></div>
                <div class="d-flex justify-content-between align-items-start position-relative">
                    <div>
                        <div class="small opacity-75 mb-1 fw-bold">إجمالي الأرباح</div>
                        <h3 class="fw-bold mb-0">@ViewBag.TotalRevenue.ToString("N2") <small class="fs-6">د.ك</small></h3>
                    </div>
                    <div class="stat-icon-sm"><i class="fas fa-money-bill-wave"></i></div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card p-4 rounded-4 shadow-sm border-0 h-100 bg-white-adaptive border-bottom border-warning border-4">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="small text-muted mb-1 fw-bold">إجمالي الحجوزات</div>
                        <h3 class="fw-bold mb-0">@ViewBag.TotalBookings</h3>
                    </div>
                    <div class="stat-icon-sm text-warning bg-soft-warning"><i class="fas fa-ticket-alt"></i></div>
                </div>
                <div class="mt-3 small text-success">
                    <i class="fas fa-arrow-up me-1"></i> 12% منذ الأسبوع الماضي
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card p-4 rounded-4 shadow-sm border-0 h-100 bg-white border-bottom border-success border-4">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="small text-muted mb-1 fw-bold">الرحلات القادمة</div>
                        <h3 class="fw-bold mb-0">@ViewBag.ActiveTrips</h3>
                    </div>
                    <div class="stat-icon-sm text-success bg-soft-success"><i class="fas fa-train"></i></div>
                </div>
                <div class="mt-3 small text-muted">جدول اليوم</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card p-4 rounded-4 shadow-sm border-0 h-100 bg-white border-bottom border-info border-4">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="small text-muted mb-1 fw-bold">المستخدمين</div>
                        <h3 class="fw-bold mb-0">@ViewBag.TotalUsers</h3>
                    </div>
                    <div class="stat-icon-sm text-info bg-soft-info"><i class="fas fa-users"></i></div>
                </div>
                <div class="mt-3 small text-muted">حسابات نشطة</div>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="row g-4 mb-5">
        <!-- Analytics Chart -->
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm rounded-4 overflow-hidden h-100">
                <div class="card-header bg-white-adaptive p-4 border-0 d-flex justify-content-between align-items-center">
                    <h5 class="fw-bold mb-0"><i class="fas fa-chart-area text-primary me-2"></i>تحليل نشاط الحجز</h5>
                    <div class="dropdown">
                        <button class="btn btn-light btn-sm rounded-pill px-3" type="button">آخر 7 أيام</button>
                    </div>
                </div>
                <div class="card-body p-4 pt-0">
                    <div style="height: 350px;">
                        <canvas id="bookingsChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Center -->
        <div class="col-lg-4">
            <div class="card border-0 shadow-sm rounded-4 overflow-hidden h-100">
                <div class="card-header bg-white-adaptive p-4 border-0">
                    <h5 class="fw-bold mb-0"><i class="fas fa-th-large text-primary me-2"></i>إدارة النظام</h5>
                </div>
                <div class="card-body p-4 pt-2">
                    <div class="d-grid gap-3">
                        <a asp-action="Trips" class="admin-action-btn p-3 rounded-4 d-flex align-items-center text-decoration-none border-0 shadow-sm border-start border-4 border-primary">
                            <div class="action-icon-modern bg-primary-soft text-primary rounded-4 me-3"><i class="fas fa-route"></i></div>
                            <div>
                                <div class="fw-bold text-dark">جدولة الرحلات</div>
                                <div class="small text-muted">إدارة المواعيد والخطوط</div>
                            </div>
                            <div class="ms-auto btn-arrow"><i class="fas fa-chevron-left"></i></div>
                        </a>
                        
                        <a asp-action="Trains" class="admin-action-btn p-3 rounded-4 d-flex align-items-center text-decoration-none border-0 shadow-sm border-start border-4 border-secondary">
                            <div class="action-icon-modern bg-secondary-soft text-secondary rounded-4 me-3"><i class="fas fa-train-subway"></i></div>
                            <div>
                                <div class="fw-bold text-dark">أسطول القاطرات</div>
                                <div class="small text-muted">تفاصيل القطارات والسعة</div>
                            </div>
                            <div class="ms-auto btn-arrow"><i class="fas fa-chevron-left"></i></div>
                        </a>
                        
                        <a asp-action="Stations" class="admin-action-btn p-3 rounded-4 d-flex align-items-center text-decoration-none border-0 shadow-sm border-start border-4 border-success">
                            <div class="action-icon-modern bg-success-soft text-success rounded-4 me-3"><i class="fas fa-map-location-dot"></i></div>
                            <div>
                                <div class="fw-bold text-dark">شبكة المحطات</div>
                                <div class="small text-muted">المواقع والإحداثيات الجغرافية</div>
                            </div>
                            <div class="ms-auto btn-arrow"><i class="fas fa-chevron-left"></i></div>
                        </a>
                        
                        <a asp-action="Notifications" class="admin-action-btn p-3 rounded-4 d-flex align-items-center text-decoration-none border-0 shadow-sm border-start border-4 border-info">
                            <div class="action-icon-modern bg-info-soft text-info rounded-4 me-3"><i class="fas fa-bullhorn"></i></div>
                            <div>
                                <div class="fw-bold text-dark">تنبيهات النظام</div>
                                <div class="small text-muted">إدارة الرسائل والإشعارات</div>
                            </div>
                            <div class="ms-auto btn-arrow"><i class="fas fa-chevron-left"></i></div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Data -->
    <div class="card border-0 shadow-sm rounded-4 overflow-hidden border-top border-primary border-4">
        <div class="card-header bg-white-adaptive p-4 border-0 d-flex justify-content-between align-items-center">
            <h5 class="fw-bold mb-0">آخر العمليات المكتملة</h5>
            <a href="#" class="btn btn-soft-primary btn-sm rounded-pill px-3">عرض الكل</a>
        </div>
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0 custom-admin-table">
                <thead class="bg-light">
                    <tr>
                        <th class="px-4 py-3">المسافر</th>
                        <th class="px-3 py-3">الوجهة</th>
                        <th class="px-3 py-3 text-center">المقعد</th>
                        <th class="px-3 py-3">المبلغ</th>
                        <th class="px-3 py-3">الحالة</th>
                        <th class="px-3 py-3">التوقيت</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var booking in Model)
                    {
                        <tr>
                            <td class="px-4 py-3">
                                <div class="d-flex align-items-center">
                                    <div class="avatar-circle me-3">@booking.PassengerName.Substring(0,1)</div>
                                    <div class="fw-bold">@booking.PassengerName</div>
                                </div>
                            </td>
                            <td class="px-3 py-3">
                                <div class="small fw-semibold">@(booking.Trip?.FromStation?.Name ?? "N/A")</div>
                                <div class="text-primary small"><i class="fas fa-arrow-left fa-xs px-1"></i> @(booking.Trip?.ToStation?.Name ?? "N/A")</div>
                            </td>
                            <td class="px-3 py-3 text-center">
                                <span class="badge bg-light text-dark border">@booking.SeatNumber</span>
                            </td>
                            <td class="px-3 py-3 fw-bold text-primary">@booking.Price.ToString("N3") <span class="small font-normal text-muted">د.ك</span></td>
                            <td class="px-3 py-3">
                                <span class="badge rounded-pill bg-soft-success text-success px-3 py-2">
                                    <i class="fas fa-check-circle me-1"></i> مؤكد
                                </span>
                            </td>
                            <td class="px-3 py-3 text-muted small">
                                <div>@booking.BookingDate.ToString("dd/MM/yyyy")</div>
                                <div>@booking.BookingDate.ToString("HH:mm")</div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<style>
    /* Admin Styling Overrides */
    :root {
        --primary-gradient: linear-gradient(135deg, #0d6efd 0%, #003d99 100%);
        --bs-card-border-radius: 1rem;
    }

    .bg-gradient-primary { background: var(--primary-gradient); }
    .bg-soft-primary { background-color: rgba(13, 110, 253, 0.1); }
    .bg-soft-warning { background-color: rgba(255, 193, 7, 0.1); }
    .bg-soft-success { background-color: rgba(40, 167, 69, 0.1); }
    .bg-soft-info { background-color: rgba(23, 162, 184, 0.1); }
    
    .bg-primary-soft { background-color: rgba(13, 110, 253, 0.08); }
    .bg-secondary-soft { background-color: rgba(108, 117, 125, 0.08); }
    .bg-success-soft { background-color: rgba(40, 167, 69, 0.08); }
    .bg-info-soft { background-color: rgba(23, 162, 184, 0.08); }
    
    .btn-soft-primary { background-color: rgba(13, 110, 253, 0.1); color: #0d6efd; border: none; }
    .btn-soft-primary:hover { background-color: #0d6efd; color: #fff; }

    /* Stat Cards */
    .stat-card { transition: all 0.3s ease; }
    .stat-card:hover { transform: translateY(-5px); box-shadow: 0 1rem 3rem rgba(0,0,0,0.1) !important; }
    
    .stat-icon-sm { width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.25rem; }
    
    .stat-icon-bg { 
        position: absolute; 
        right: -10px; 
        bottom: -20px; 
        font-size: 8rem; 
        opacity: 0.1; 
        transform: rotate(-15deg); 
    }

    /* Action Buttons Modern */
    .admin-action-btn { 
        background-color: var(--card-bg); 
        color: var(--text-color);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
        border-radius: 1.25rem !important;
        border: 1px solid var(--border-color) !important;
    }
    .admin-action-btn:hover { 
        background-color: var(--input-bg); 
        transform: scale(1.02) translateX(-5px); 
        box-shadow: 0 10px 20px rgba(0,0,0,0.08) !important;
    }
    
    .action-icon-modern { 
        width: 52px; 
        height: 52px; 
        display: flex; 
        align-items: center; 
        justify-content: center; 
        font-size: 1.4rem;
        transition: all 0.3s ease;
    }
    .admin-action-btn:hover .action-icon-modern {
        transform: rotate(10deg);
    }
    
    .btn-arrow {
        color: #ccc;
        transition: all 0.3s ease;
    }
    .admin-action-btn:hover .btn-arrow {
        color: var(--bs-primary);
        transform: translateX(-5px);
    }

    /* Table Styles */
    .custom-admin-table thead th { font-weight: 700; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.5px; }
    .avatar-circle { 
        width: 40px; 
        height: 40px; 
        background: #eee; 
        border-radius: 50%; 
        display: flex; 
        align-items: center; 
        justify-content: center; 
        font-weight: bold; 
        color: #555;
    }

    /* Redundant inline dark mode moved to site.css */
</style>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const ctx = document.getElementById('bookingsChart').getContext('2d');
            
            // Custom Gradient
            const gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(13, 110, 253, 0.4)');
            gradient.addColorStop(1, 'rgba(13, 110, 253, 0.0)');

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewBag.ChartLabels)),
                    datasets: [{
                        label: 'الحجوزات',
                        data: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewBag.ChartData)),
                        borderColor: '#0d6efd',
                        backgroundColor: gradient,
                        borderWidth: 4,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#0d6efd',
                        pointBorderWidth: 3,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#1a1a1a',
                            titleFont: { size: 14, family: 'Cairo' },
                            bodyFont: { size: 13, family: 'Cairo' },
                            padding: 12,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    return context.parsed.y + ' حجز';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(0,0,0,0.05)', drawBorder: false },
                            ticks: { 
                                stepSize: 1,
                                font: { size: 12 }
                            }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { font: { size: 12 } }
                        }
                    }
                }
            });
        });
    </script>
}
