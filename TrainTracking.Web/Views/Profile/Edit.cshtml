@model TrainTracking.Domain.Entities.ApplicationUser

@{
    ViewData["Title"] = "تعديل الملف الشخصي";
}

<div class="container mt-5 pb-5">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a asp-action="Index">الملف الشخصي</a></li>
                    <li class="breadcrumb-item active">تعديل البيانات</li>
                </ol>
            </nav>

            <div class="card shadow-lg border-0 rounded-4 overflow-hidden">
                <div class="card-header bg-primary text-white py-4 position-relative">
                    <h3 class="mb-0 fw-bold text-center"><i class="fas fa-edit me-2"></i> تعديل ملفك الشخصي</h3>
                    <div class="position-absolute bottom-0 start-50 translate-middle-x bg-white rounded-circle p-1 shadow" style="margin-bottom: -50px;">
                         @if (!string.IsNullOrEmpty(Model.ProfilePicturePath))
                         {
                             <img id="profilePreview" src="@Model.ProfilePicturePath" class="rounded-circle" width="100" height="100" style="object-fit: cover;" alt="Preview">
                         }
                         else
                         {
                             <div id="profilePreview" class="rounded-circle bg-light d-flex align-items-center justify-content-center" style="width: 100px; height: 100px;">
                                 <i class="fas fa-user fa-3x text-secondary opacity-25"></i>
                             </div>
                         }
                    </div>
                </div>
                
                <div class="card-body p-5 pt-5 mt-4">
                    <form asp-action="Edit" method="post" enctype="multipart/form-data" class="mt-3">
                        @Html.AntiForgeryToken()
                        @Html.HiddenFor(m => m.Id)
                        @Html.HiddenFor(m => m.CreatedAt)
                        @Html.HiddenFor(m => m.IsActive)
                        @Html.HiddenFor(m => m.ProfilePicturePath)
                        @Html.HiddenFor(m => m.UserName)
                        @Html.HiddenFor(m => m.Email)

                        <div asp-validation-summary="ModelOnly" class="alert alert-danger rounded-3"></div>

                        <!-- Picture Upload Button -->
                        <div class="text-center mb-5">
                            <label for="profilePicture" class="btn btn-outline-primary btn-sm rounded-pill px-4 shadow-sm cursor-pointer">
                                <i class="fas fa-camera me-2"></i> تغيير الصورة الشخصية
                            </label>
                            <input type="file" id="profilePicture" name="profilePicture" accept="image/*" style="display: none;" onchange="previewImage(event)">
                        </div>

                        <div class="row g-4">
                            <!-- Full Name -->
                            <div class="col-md-12">
                                <div class="form-floating mb-3">
                                    <input asp-for="FullName" class="form-control bg-light border-0 rounded-3 shadow-none" placeholder="الاسم الكامل">
                                    <label asp-for="FullName">الاسم الكامل <span class="text-danger">*</span></label>
                                    <span asp-validation-for="FullName" class="text-danger small"></span>
                                </div>
                            </div>

                            <!-- Phone & DOB -->
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input asp-for="PhoneNumber" class="form-control bg-light border-0 rounded-3 shadow-none" placeholder="رقم الهاتف">
                                    <label asp-for="PhoneNumber">رقم الهاتف</label>
                                    <span asp-validation-for="PhoneNumber" class="text-danger small"></span>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input asp-for="DateOfBirth" type="date" class="form-control bg-light border-0 rounded-3 shadow-none" placeholder="تاريخ الميلاد">
                                    <label asp-for="DateOfBirth">تاريخ الميلاد</label>
                                    <span asp-validation-for="DateOfBirth" class="text-danger small"></span>
                                </div>
                            </div>

                            <!-- City & Country -->
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input asp-for="City" class="form-control bg-light border-0 rounded-3 shadow-none" placeholder="المدينة">
                                    <label asp-for="City">المدينة</label>
                                    <span asp-validation-for="City" class="text-danger small"></span>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input asp-for="Country" class="form-control bg-light border-0 rounded-3 shadow-none" placeholder="الدولة">
                                    <label asp-for="Country">الدولة</label>
                                    <span asp-validation-for="Country" class="text-danger small"></span>
                                </div>
                            </div>

                            <!-- Address -->
                            <div class="col-12">
                                <div class="form-floating mb-3">
                                    <input asp-for="Address" class="form-control bg-light border-0 rounded-3 shadow-none" placeholder="العنوان">
                                    <label asp-for="Address">العنوان التفصيلي</label>
                                    <span asp-validation-for="Address" class="text-danger small"></span>
                                </div>
                            </div>

                            <!-- Bio -->
                            <div class="col-12">
                                <div class="form-group mb-3">
                                    <label asp-for="Bio" class="form-label fw-bold text-muted small ms-2">نبذة تعريفية</label>
                                    <textarea asp-for="Bio" class="form-control bg-light border-0 rounded-3 shadow-none" rows="5" placeholder="اكتب شيئاً عن نفسك..."></textarea>
                                    <span asp-validation-for="Bio" class="text-danger small"></span>
                                </div>
                            </div>
                        </div>

                        <hr class="my-5 opacity-10">

                        <!-- Buttons -->
                        <div class="d-flex flex-column flex-md-row gap-3 justify-content-center">
                            <button type="submit" class="btn btn-primary btn-lg px-5 rounded-pill shadow-sm">
                                <i class="fas fa-save me-2"></i> حفظ التغييرات
                            </button>
                            <a asp-action="Index" class="btn btn-light btn-lg px-5 rounded-pill">
                                <i class="fas fa-times me-2"></i> إلغاء
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <script>
        function previewImage(event) {
            const file = event.target.files[0];
            const preview = document.getElementById('profilePreview');

            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" class="rounded-circle" width="100" height="100" style="object-fit: cover;" alt="Preview">`;
                }
                reader.readAsDataURL(file);
            }
        }
    </script>
}

<style>
    .form-floating > .form-control:focus ~ label, 
    .form-floating > .form-control:not(:placeholder-shown) ~ label {
        color: var(--bs-primary);
        font-weight: bold;
    }
    .cursor-pointer { cursor: pointer; }
</style>